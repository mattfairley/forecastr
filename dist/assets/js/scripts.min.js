var weatherApp={};weatherApp.init=function(){weatherApp.$submit=$("#get-weather"),weatherApp.$cityField=$("#city"),weatherApp.$forecast=$("#forecast"),weatherApp.$changeCity=$("#change"),weatherApp.$submit.on("submit",function(e){e.preventDefault(),weatherApp.getWeather()}),weatherApp.$changeCity.on("click",function(e){e.preventDefault(),weatherApp.clearForecast()})},weatherApp.getWeather=function(){weatherApp.city=weatherApp.$cityField.val(),""!==weatherApp.city?weatherApp.getData(weatherApp.city):swal({title:"Whoops!",text:"Enter a city name",type:"error"})},weatherApp.getData=function(e){$.ajax({url:"http://api.openweathermap.org/data/2.5/forecast/daily",type:"GET",dataType:"jsonp",data:{APPID:"7699bac00fc6df4c0ff4b215ca742fd0",q:e,cnt:7,units:"metric"},success:function(e){weatherApp.city=e.city.name,weatherApp.success=!0,weatherApp.parseData(e.list)},error:function(){weatherApp.cityNotFound(e)}})},weatherApp.parseData=function(e){weatherApp.forecast=[],weatherApp.pressure=0,$.each(e,function(e,t){weatherApp.forecast.push({date:weatherApp.getDate(e),dailyHigh:Math.round(t.temp.max),dailyLow:Math.round(t.temp.min),iconsrc:"http://openweathermap.org/img/w/"+t.weather[0].icon+".png"}),weatherApp.pressure+=t.pressure}),weatherApp.avgPressure=Math.round(weatherApp.pressure/weatherApp.forecast.length),weatherApp.updateDOM(weatherApp.forecast,weatherApp.avgPressure)},weatherApp.getDate=function(e){var t=new Date;t.setDate(t.getDate()+e);var a=t.getDate(),p=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"],r=p[t.getMonth()],h=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],s=h[t.getDay()];return s+" "+r+" "+a},weatherApp.updateDOM=function(e,t){$.each(e,function(e,t){var a=$("<div>").addClass("day"+e+" day").append('<p class="date">'+t.date+'</p><img class="logo" src='+t.iconsrc+'><span class="temp high">'+t.dailyHigh+'</span><span class="temp low">'+t.dailyLow+"</span>");weatherApp.$forecast.append(a)}),weatherApp.clearForm(),weatherApp.createChart(e),weatherApp.pressureIndicator(t)},weatherApp.createChart=function(e){weatherApp.$forecast.append('<canvas id="weatherChart" class="chart" width="685" height="300"></canvas>'),weatherApp.ctx=$("#weatherChart").get(0).getContext("2d"),weatherApp.options={scaleShowGridLines:!1,datasetFill:!1},weatherApp.data={labels:[],datasets:[{label:"Weekly highs",fillColor:"rgba(220,220,220,0.2)",strokeColor:"rgba(220,220,220,1)",pointColor:"rgba(220,220,220,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220,220,220,1)",data:[]},{label:"Weekly lows",fillColor:"rgba(151,187,205,0.2)",strokeColor:"rgba(151,187,205,1)",pointColor:"rgba(151,187,205,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:[]}]},$.each(e,function(t){weatherApp.data.labels.push(e[t].date),weatherApp.data.datasets[0].data.push(e[t].dailyHigh),weatherApp.data.datasets[1].data.push(e[t].dailyLow)});new Chart(weatherApp.ctx).Line(weatherApp.data,weatherApp.options)},weatherApp.pressureIndicator=function(e){var t=$("<p>").addClass("pressure");t.html(1e3>=e?"The average pressure will be "+e+"mb. There's a low pressure system. It might rain!":e>=1020?"The average pressure will be "+e+"mb this week. There's a low pressure system. It'll probably be a dry week!":"The average pressure will be "+e+"mb this week. Check the forecast!"),weatherApp.$forecast.append(t)},weatherApp.clearForm=function(){weatherApp.$submit.fadeOut(function(){var e=$("<h2>").addClass("city").html('<span class="city">'+weatherApp.city+"'s</span> 7-day forecast");$("#input").append(e),$("h2.city").fadeIn(),weatherApp.$cityField.val(""),weatherApp.$changeCity.fadeIn()})},weatherApp.clearForecast=function(){weatherApp.$forecast.html(""),$("h2.city").fadeOut(function(){weatherApp.$changeCity.fadeOut(),weatherApp.$submit.fadeIn(),$("h2.city").html("")})},weatherApp.cityNotFound=function(e){swal({title:"Whoops!",text:e+" wasn't found! Check your spelling and try again!",type:"error"})},$(function(){weatherApp.init()});